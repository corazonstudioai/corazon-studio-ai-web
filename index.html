<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Coraz√≥n Studio AI</title>
</head>

<body style="font-family: Arial; text-align:center; padding: 24px;">
  <h1 style="margin-bottom: 6px;">üíô Coraz√≥n Studio AI</h1>
  <p style="margin-top: 0; opacity: 0.8;">Tu plataforma de inteligencia artificial con prop√≥sito.</p>

  <!-- Selector de idioma (solo 1 a la vez) -->
  <div style="margin: 16px 0;">
    <label for="lang"><b>Idioma:</b></label>
    <select id="lang" style="padding: 8px; margin-left: 8px;">
      <option value="es" selected>Espa√±ol</option>
      <option value="en">English</option>
    </select>
  </div>

  <!-- Estado -->
  <div style="margin: 12px 0;">
    <button onclick="probarConexion()" style="padding: 10px 14px;">Probar conexi√≥n con IA</button>
    <div id="estado" style="margin-top: 10px; font-weight: bold;"></div>
  </div>

  <hr style="max-width: 720px; margin: 22px auto; opacity: 0.25;"/>

  <!-- CHAT -->
  <div style="max-width: 720px; margin: 0 auto; text-align: left;">
    <h2>üí¨ Chat</h2>
    <textarea id="chatInput" rows="4" style="width: 100%; padding: 10px;" placeholder="Escribe tu mensaje..."></textarea>
    <div style="margin-top: 10px;">
      <button onclick="enviarChat()" style="padding: 10px 14px;">Enviar</button>
    </div>
    <div id="chatRespuesta" style="white-space: pre-wrap; margin-top: 12px; padding: 12px; border: 1px solid #ddd; border-radius: 8px;"></div>
  </div>

  <hr style="max-width: 720px; margin: 22px auto; opacity: 0.25;"/>

  <!-- IM√ÅGENES -->
  <div style="max-width: 720px; margin: 0 auto; text-align: left;">
    <h2>üñºÔ∏è Im√°genes</h2>
    <input id="imgPrompt" style="width: 100%; padding: 10px;" placeholder="Describe la imagen que quieres..." />
    <div style="margin-top: 10px;">
      <button onclick="generarImagen()" style="padding: 10px 14px;">Generar imagen</button>
    </div>
    <div id="imgEstado" style="margin-top: 10px; font-weight: bold;"></div>
    <img id="imgResultado" alt="" style="max-width:100%; margin-top: 12px; border-radius: 10px; display:none;" />
  </div>

  <hr style="max-width: 720px; margin: 22px auto; opacity: 0.25;"/>

  <!-- VIDEO -->
  <div style="max-width: 720px; margin: 0 auto; text-align: left;">
    <h2>üé¨ Video</h2>
    <input id="videoPrompt" style="width: 100%; padding: 10px;" placeholder="Describe el video que quieres..." />
    <div style="margin-top: 10px;">
      <button onclick="generarVideo()" style="padding: 10px 14px;">Generar video</button>
    </div>
    <div id="videoEstado" style="margin-top: 10px; font-weight: bold;"></div>
    <video id="videoResultado" controls style="width: 100%; margin-top: 12px; border-radius: 10px; display:none;"></video>
  </div>

  <script>
    // ‚úÖ Pega aqu√≠ tu URL de Render (backend)
    const BACKEND = "TU_BACKEND_RENDER_URL_AQUI"; // ejemplo: https://corazon-studio-ai-backend-3.onrender.com

    function getLang() {
      return document.getElementById("lang").value;
    }

    async function probarConexion() {
      const estado = document.getElementById("estado");
      estado.textContent = "Probando...";
      try {
        const res = await fetch(`${BACKEND}/health`);
        const data = await res.json();
        estado.textContent = data.mensaje || "‚úÖ Conectado correctamente";
      } catch (e) {
        estado.textContent = "‚ùå No se pudo conectar. Revisa backend/CORS.";
      }
    }

    async function enviarChat() {
      const box = document.getElementById("chatRespuesta");
      const msg = document.getElementById("chatInput").value.trim();
      if (!msg) return;

      box.textContent = "Pensando...";
      try {
        const res = await fetch(`${BACKEND}/chat`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: msg, lang: getLang() })
        });
        const data = await res.json();
        box.textContent = data.reply || "Sin respuesta.";
      } catch (e) {
        box.textContent = "‚ùå Error conectando con el backend.";
      }
    }

    async function generarImagen() {
      const estado = document.getElementById("imgEstado");
      const img = document.getElementById("imgResultado");
      // reset
      img.style.display = "none";
      img.src = "";
      estado.textContent = "";

      const prompt = document.getElementById("imgPrompt").value.trim();
      if (!prompt) return;

      estado.textContent = "Generando imagen...";
      try {
        const res = await fetch(`${BACKEND}/image`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt, lang: getLang() })
        });
        const data = await res.json();

        if (!data.data_url) {
          estado.textContent = "‚ùå No se recibi√≥ imagen.";
          return;
        }
        img.src = data.data_url;
        img.style.display = "block";
        estado.textContent = "‚úÖ Imagen lista";
      } catch (e) {
        estado.textContent = "‚ùå Error generando imagen.";
      }
    }

    async function generarVideo() {
      const estado = document.getElementById("videoEstado");
      const vid = document.getElementById("videoResultado");
      // reset
      vid.style.display = "none";
      vid.src = "";
      estado.textContent = "";

      const prompt = document.getElementById("videoPrompt").value.trim();
      if (!prompt) return;

      estado.textContent = "Generando video (puede tardar)...";
      try {
        const res = await fetch(`${BACKEND}/video`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt, lang: getLang() })
        });
        const data = await res.json();

        if (!data.video_id) {
          estado.textContent = "‚ùå No se recibi√≥ video_id.";
          return;
        }

        // Backend sirve el mp4 desde /video/{id}
        vid.src = `${BACKEND}/video/${data.video_id}`;
        vid.style.display = "block";
        estado.textContent = "‚úÖ Video listo";
      } catch (e) {
        estado.textContent = "‚ùå Error generando video.";
      }
    }
  </script>
</body>
</html>

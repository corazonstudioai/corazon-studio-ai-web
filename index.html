<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Coraz√≥n Studio AI</title>
</head>

<body style="font-family: Arial; text-align: center; padding: 20px;">
  <h1>üíô Coraz√≥n Studio AI</h1>
  <p>Tu plataforma de inteligencia artificial con prop√≥sito.</p>

  <!-- ‚úÖ IMPORTANTE: tu backend -->
  <script>
    const API_URL = "https://corazon-studio-ai-backend-3.onrender.com";
  </script>

  <div style="margin: 15px 0;">
    <label style="font-weight: bold;">Idioma:&nbsp;</label>
    <select id="idioma" style="padding: 8px;">
      <option value="es" selected>Espa√±ol</option>
      <option value="en">English</option>
    </select>
  </div>

  <button onclick="probarConexion()" style="padding: 12px 18px; font-size: 16px; cursor: pointer;">
    Probar conexi√≥n con IA
  </button>

  <p id="conexion" style="margin-top: 12px; font-weight: bold;"></p>

  <hr style="margin: 25px 0;" />

  <!-- üí¨ CHAT -->
  <h2 style="text-align:left; max-width: 720px; margin: 0 auto;">üí¨ Chat</h2>

  <div style="max-width: 720px; margin: 10px auto; text-align:left;">
    <textarea id="chatInput" placeholder="Escribe tu mensaje..." rows="5"
      style="width:100%; padding: 12px; font-size: 16px;"></textarea>

    <button onclick="enviarChat()" style="margin-top: 10px; padding: 10px 16px; cursor: pointer;">
      Enviar
    </button>

    <div id="chatOutput"
      style="margin-top: 12px; padding: 12px; border: 1px solid #ddd; min-height: 40px; background: #fafafa;">
    </div>
  </div>

  <hr style="margin: 25px 0;" />

  <!-- üñºÔ∏è IM√ÅGENES -->
  <h2 style="text-align:left; max-width: 720px; margin: 0 auto;">üñºÔ∏è Im√°genes</h2>

  <div style="max-width: 720px; margin: 10px auto; text-align:left;">
    <input id="imgPrompt" placeholder="Describe la imagen que quieres..."
      style="width:100%; padding: 12px; font-size: 16px;" />

    <button onclick="generarImagen()" style="margin-top: 10px; padding: 10px 16px; cursor: pointer;">
      Generar imagen
    </button>

    <div id="imgOutput" style="margin-top: 12px;"></div>
  </div>

  <hr style="margin: 25px 0;" />

  <!-- üé¨ VIDEO -->
  <h2 style="text-align:left; max-width: 720px; margin: 0 auto;">üé¨ Video</h2>

  <div style="max-width: 720px; margin: 10px auto; text-align:left;">
    <input id="videoPrompt" placeholder="Describe el video que quieres..."
      style="width:100%; padding: 12px; font-size: 16px;" />

    <button onclick="generarVideo()" style="margin-top: 10px; padding: 10px 16px; cursor: pointer;">
      Generar video
    </button>

    <div id="videoOutput"
      style="margin-top: 12px; padding: 12px; border: 1px solid #ddd; min-height: 40px; background: #fafafa;">
    </div>
  </div>

  <script>
    function getIdioma() {
      return document.getElementById("idioma").value || "es";
    }

    async function probarConexion() {
      const el = document.getElementById("conexion");
      el.textContent = "‚è≥ Probando...";
      try {
        const res = await fetch(`${API_URL}/health`, { method: "GET" });
        const data = await res.json();
        if (res.ok) {
          el.textContent = "‚úÖ Conectado correctamente";
        } else {
          el.textContent = "‚ùå Error de conexi√≥n";
          console.log(data);
        }
      } catch (e) {
        el.textContent = "‚ùå No se pudo conectar";
        console.error(e);
      }
    }

    async function enviarChat() {
      const input = document.getElementById("chatInput").value.trim();
      const out = document.getElementById("chatOutput");

      if (!input) {
        out.textContent = "‚ö†Ô∏è Escribe un mensaje.";
        return;
      }

      out.textContent = "‚è≥ Pensando...";
      try {
        const res = await fetch(`${API_URL}/chat`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            message: input,
            lang: getIdioma()
          })
        });

        const data = await res.json();

        if (!res.ok) {
          out.textContent = "‚ùå Error en chat.";
          console.log(data);
          return;
        }

        out.textContent = data.reply ?? data.message ?? JSON.stringify(data);
      } catch (e) {
        out.textContent = "‚ùå Error de red en chat.";
        console.error(e);
      }
    }

    async function generarImagen() {
      const prompt = document.getElementById("imgPrompt").value.trim();
      const out = document.getElementById("imgOutput");

      if (!prompt) {
        out.innerHTML = "<p>‚ö†Ô∏è Escribe una descripci√≥n para la imagen.</p>";
        return;
      }

      out.innerHTML = "<p>‚è≥ Generando imagen...</p>";

      try {
        const res = await fetch(`${API_URL}/image`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            prompt,
            lang: getIdioma()
          })
        });

        const data = await res.json();

        if (!res.ok) {
          out.innerHTML = "<p>‚ùå Error generando imagen.</p>";
          console.log(data);
          return;
        }

        // Acepta varios formatos: image_url, url, base64
        const imageUrl = data.image_url || data.url || null;
        const base64 = data.base64 || data.image_base64 || null;

        if (imageUrl) {
          out.innerHTML = `
            <p>‚úÖ Imagen lista:</p>
            <img src="${imageUrl}" alt="Imagen generada" style="max-width:100%; border:1px solid #ddd;" />
          `;
          return;
        }

        if (base64) {
          out.innerHTML = `
            <p>‚úÖ Imagen lista:</p>
            <img src="data:image/png;base64,${base64}" alt="Imagen generada" style="max-width:100%; border:1px solid #ddd;" />
          `;
          return;
        }

        out.innerHTML = `<p>‚úÖ Respuesta recibida, pero no vino la imagen. Mira consola.</p>`;
        console.log("Respuesta /image:", data);
      } catch (e) {
        out.innerHTML = "<p>‚ùå Error de red en imagen.</p>";
        console.error(e);
      }
    }

    async function generarVideo() {
      const prompt = document.getElementById("videoPrompt").value.trim();
      const out = document.getElementById("videoOutput");

      if (!prompt) {
        out.textContent = "‚ö†Ô∏è Escribe una descripci√≥n para el video.";
        return;
      }

      out.textContent = "‚è≥ Generando video...";

      try {
        const res = await fetch(`${API_URL}/video`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            prompt,
            lang: getIdioma()
          })
        });

        const data = await res.json();

        if (!res.ok) {
          out.textContent = "‚ùå Error generando video.";
          console.log(data);
          return;
        }

        // Posibles respuestas:
        // - { video_url: "https://..." }
        // - { url: "https://..." }
        // - { video_id: "abc123" }
        const videoUrl = data.video_url || data.url || null;
        const videoId = data.video_id || data.id || null;

        if (videoUrl) {
          out.innerHTML = `
            ‚úÖ Video listo:
            <div style="margin-top:10px;">
              <a href="${videoUrl}" target="_blank">Abrir video</a>
            </div>
          `;
          return;
        }

        if (videoId) {
          const link = `${API_URL}/video/${videoId}`;
          out.innerHTML = `
            ‚úÖ Video creado con ID: <b>${videoId}</b>
            <div style="margin-top:10px;">
              <a href="${link}" target="_blank">Abrir /video/${videoId}</a>
            </div>
            <div style="margin-top:10px; font-size: 14px;">
              Si a√∫n no est√° listo, vuelve a abrir el enlace en 10‚Äì30 segundos.
            </div>
          `;
          return;
        }

        out.textContent = "‚úÖ Respuesta recibida, pero no vino URL ni ID de video. Mira consola.";
        console.log("Respuesta /video:", data);
      } catch (e) {
        out.textContent = "‚ùå Error de red en video.";
        console.error(e);
      }
    }
  </script>
</body>
</html>

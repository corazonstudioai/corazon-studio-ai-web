<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Coraz√≥n Studio AI</title>
  <style>
    :root{
      --bg1:#0B0F1E;
      --bg2:#1B1536;
      --card: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.14);
      --text:#F3F4F6;
      --muted: rgba(255,255,255,.75);
      --accent:#7C5CFF;
      --accent2:#B794F4;
      --btn: rgba(255,255,255,.10);
      --btnStroke: rgba(255,255,255,.16);
      --good:#22c55e;
      --bad:#ef4444;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 20% 10%, #3a2a7a 0%, transparent 60%),
                  radial-gradient(900px 700px at 80% 30%, #2a6aa6 0%, transparent 55%),
                  linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100vh;
      padding: 18px 14px 40px;
    }
    .wrap{
      max-width: 980px;
      margin: 0 auto;
    }
    .hero{
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom:14px;
    }
    .logo{
      width:44px;height:44px;border-radius:14px;
      background: radial-gradient(circle at 30% 30%, var(--accent2), var(--accent));
      display:flex;align-items:center;justify-content:center;
      box-shadow: 0 10px 35px rgba(124,92,255,.35);
      flex:0 0 auto;
    }
    .logo span{font-size:20px}
    h1{
      font-size: 28px;
      margin:0;
      letter-spacing: .2px;
    }
    .sub{
      margin: 3px 0 0;
      color: var(--muted);
      font-size: 13px;
    }
    .tabs{
      background: rgba(255,255,255,.06);
      border: 1px solid var(--stroke);
      border-radius: 22px;
      padding: 10px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin: 10px 0 16px;
      backdrop-filter: blur(10px);
    }
    .tab{
      padding: 10px 14px;
      border-radius: 16px;
      background: transparent;
      border: 1px solid transparent;
      color: var(--text);
      cursor:pointer;
      font-weight:700;
      display:flex;
      align-items:center;
      gap:8px;
      opacity:.85;
    }
    .tab.active{
      background: rgba(124,92,255,.22);
      border-color: rgba(124,92,255,.35);
      opacity:1;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
    }
    @media(min-width: 980px){
      .grid.two{
        grid-template-columns: 1.2fr .8fr;
      }
    }
    .card{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: 22px;
      padding: 14px;
      backdrop-filter: blur(12px);
      box-shadow: 0 14px 50px rgba(0,0,0,.25);
    }
    .card h2{
      margin:0 0 10px;
      font-size: 20px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .hint{
      color: var(--muted);
      font-size: 13px;
      margin-top: 6px;
      line-height:1.35;
    }
    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    @media(max-width: 520px){
      .row{grid-template-columns:1fr}
    }
    label{
      display:block;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
    }
    textarea, select, input{
      width:100%;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color: var(--text);
      padding: 12px 12px;
      outline:none;
    }
    textarea{min-height: 110px; resize: vertical;}
    .btnrow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 12px;
    }
    button{
      border-radius: 14px;
      border: 1px solid var(--btnStroke);
      background: var(--btn);
      color: var(--text);
      padding: 11px 14px;
      font-weight: 800;
      cursor:pointer;
    }
    button.primary{
      background: rgba(124,92,255,.30);
      border-color: rgba(124,92,255,.42);
    }
    button:disabled{opacity:.55; cursor:not-allowed}
    .status{
      font-size: 13px;
      margin-top: 10px;
      color: var(--muted);
      display:flex;
      align-items:center;
      gap:8px;
      word-break: break-word;
    }
    .dot{
      width:10px;height:10px;border-radius:99px;background: rgba(255,255,255,.25);
    }
    .dot.good{background: rgba(34,197,94,.85)}
    .dot.bad{background: rgba(239,68,68,.85)}

    .result{
      margin-top: 12px;
    }

    .chip{
      display:inline-flex;
      gap:8px;
      align-items:center;
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--muted);
    }

    .switchRow{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      padding: 12px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      margin-top: 10px;
    }
    .switchRow .left{
      display:flex; flex-direction:column; gap:2px;
    }
    .switchRow .title{
      font-weight: 800;
      font-size: 13px;
    }
    .switchRow .desc{
      color: var(--muted);
      font-size: 12px;
    }
    .toggle{
      width: 54px; height: 30px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.20);
      position:relative;
      cursor:pointer;
      flex:0 0 auto;
    }
    .toggle .knob{
      width: 24px; height: 24px;
      border-radius: 999px;
      background: rgba(255,255,255,.85);
      position:absolute;
      top: 2px; left: 2px;
      transition: all .18s ease;
    }
    .toggle.on{
      background: rgba(124,92,255,.30);
      border-color: rgba(124,92,255,.42);
    }
    .toggle.on .knob{ left: 28px; background: white; }

    .small{
      font-size:12px;color:var(--muted);
    }
  </style>
</head>

<body>
<div class="wrap">

  <div class="hero">
    <div class="logo"><span>üíú</span></div>
    <div>
      <h1>Coraz√≥n Studio AI</h1>
      <div class="sub">Chat ¬∑ Imagen ¬∑ Reels (voz + m√∫sica) ¬∑ Cine (voz + m√∫sica)</div>
    </div>
  </div>

  <div class="tabs">
    <button class="tab active" data-tab="cine">üé¨ Cine</button>
    <button class="tab" data-tab="reels">üì± Reels</button>
    <button class="tab" data-tab="imagen">üñºÔ∏è Imagen</button>
    <button class="tab" data-tab="chat">üí¨ Chat</button>
  </div>

  <!-- PRESETS -->
  <div class="card">
    <h2>‚≠ê Presets (Reels / Cine)</h2>
    <div class="row">
      <div>
        <label>Selecciona un preset</label>
        <select id="presetSelect">
          <option value="">‚Äî</option>
        </select>
      </div>
      <div>
        <label>Nombre para guardar</label>
        <input id="presetName" placeholder='Ej: "Reels ES Voz F + M√∫sica suave"' />
      </div>
    </div>
    <div class="btnrow">
      <button class="primary" id="btnSavePreset">Guardar</button>
      <button id="btnApplyPreset">Aplicar</button>
      <button id="btnDeletePreset">Eliminar</button>
      <span class="chip" id="presetInfo">Se guardan en tu navegador</span>
    </div>
    <div class="hint">Tip: crea un preset ‚ÄúReels ES Voz F + M√∫sica suave‚Äù y otro ‚ÄúCine EN Voz M + Cinematic‚Äù.</div>
  </div>

  <!-- SECCIONES -->
  <div id="tab-cine" class="grid two">
    <div class="card">
      <h2>üé¨ Video Cine (con Voz + M√∫sica)</h2>

      <label>Describe el video cine...</label>
      <textarea id="cineText" placeholder="Ej: Una familia feliz caminando al atardecer, estilo cinematogr√°fico, luz c√°lida..."></textarea>

      <div class="row">
        <div>
          <label>üåç Idioma</label>
          <select id="cineLang">
            <option value="es">Espa√±ol</option>
            <option value="en">English</option>
          </select>
        </div>
        <div>
          <label>üéôÔ∏è Voz</label>
          <select id="cineVoiceGender">
            <option value="female">Femenina</option>
            <option value="male">Masculina</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>‚è±Ô∏è Duraci√≥n</label>
          <select id="cineDuration">
            <option value="5">5s</option>
            <option value="6">6s</option>
            <option value="7">7s</option>
            <option value="8">8s</option>
            <option value="9">9s</option>
          </select>
        </div>
        <div>
          <label>üéµ M√∫sica</label>
          <select id="cineMusic">
            <option value="none">Sin m√∫sica</option>
            <option value="soft">Suave</option>
            <option value="cinematic">Cinem√°tica</option>
          </select>
        </div>
      </div>

      <!-- Switch premium: Personaje + Narrador -->
      <div class="switchRow">
        <div class="left">
          <div class="title">‚≠ê Narrador + Personaje</div>
          <div class="desc">Agrega una l√≠nea extra estilo personaje (adem√°s del narrador).</div>
        </div>
        <div id="cineModeToggle" class="toggle">
          <div class="knob"></div>
        </div>
      </div>
      <div class="small">Si est√° apagado: solo narrador. Si est√° encendido: narrador + personaje.</div>

      <div class="btnrow">
        <button class="primary" id="btnCine">Crear Cine</button>
        <button id="btnCineOnly">Crear Cine (sin voz/m√∫sica)</button>
      </div>

      <div class="status" id="cineStatus"><span class="dot"></span><span>Listo.</span></div>

      <div class="result" id="cineResult"></div>
    </div>

    <div class="card">
      <h2>‚ÑπÔ∏è Tips r√°pidos</h2>
      <div class="hint">
        ‚Ä¢ Si te sale ‚ÄúArchivo no encontrado‚Äù, normalmente es porque est√°s abriendo solo <b>/files/...</b> sin el dominio completo.<br><br>
        ‚Ä¢ Aqu√≠ ya lo resolvimos: el bot√≥n ‚ÄúAbrir/Descargar‚Äù usa la URL completa autom√°ticamente.<br><br>
        ‚Ä¢ En Render, los videos se guardan en <b>/tmp</b> y pueden borrarse si reinicia el servicio (normal).
      </div>
    </div>
  </div>

  <div id="tab-reels" class="grid two" style="display:none">
    <div class="card">
      <h2>üì± Reels (con Voz + M√∫sica)</h2>

      <label>Texto del reels</label>
      <textarea id="reelsText" placeholder='Ej: "Dios ya estaba trabajando en tu milagro, incluso cuando t√∫ no lo ve√≠as..."'></textarea>

      <div class="row">
        <div>
          <label>üåç Idioma</label>
          <select id="reelsLang">
            <option value="es">Espa√±ol</option>
            <option value="en">English</option>
          </select>
        </div>
        <div>
          <label>üéôÔ∏è Voz</label>
          <select id="reelsVoiceGender">
            <option value="female">Femenina</option>
            <option value="male">Masculina</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>‚è±Ô∏è Duraci√≥n</label>
          <select id="reelsDuration">
            <option value="5">5s</option>
            <option value="6">6s</option>
            <option value="7">7s</option>
            <option value="8">8s</option>
            <option value="9" selected>9s</option>
          </select>
        </div>
        <div>
          <label>üéµ M√∫sica</label>
          <select id="reelsMusic">
            <option value="none">Sin m√∫sica</option>
            <option value="soft" selected>Suave</option>
            <option value="cinematic">Cinem√°tica</option>
          </select>
        </div>
      </div>

      <div class="switchRow">
        <div class="left">
          <div class="title">‚≠ê Narrador + Personaje</div>
          <div class="desc">Agrega una l√≠nea extra estilo personaje (adem√°s del narrador).</div>
        </div>
        <div id="reelsModeToggle" class="toggle">
          <div class="knob"></div>
        </div>
      </div>

      <div class="btnrow">
        <button class="primary" id="btnReels">Crear Reels (voz + m√∫sica)</button>
        <button id="btnReelsOnly">Crear Reels (sin voz/m√∫sica)</button>
      </div>

      <div class="status" id="reelsStatus"><span class="dot"></span><span>Listo.</span></div>

      <div class="result" id="reelsResult"></div>
    </div>

    <div class="card">
      <h2>‚úÖ M√∫sica</h2>
      <div class="hint">
        Ya subiste:<br>
        ‚Ä¢ <b>assets/music_soft.mp3</b><br>
        ‚Ä¢ <b>assets/music_cinematic.mp3</b><br><br>
        Si la m√∫sica no se oye: revisa que no sean archivos de 1 byte, y que realmente tengan varios MB.
      </div>
    </div>
  </div>

  <div id="tab-imagen" class="grid" style="display:none">
    <div class="card">
      <h2>üñºÔ∏è Imagen</h2>
      <label>Prompt</label>
      <textarea id="imgPrompt" placeholder="Ej: Imagen publicitaria realista de una cl√≠nica dental, luz c√°lida, estilo premium..."></textarea>
      <div class="row">
        <div>
          <label>Tama√±o</label>
          <select id="imgSize">
            <option>1024x1024</option>
            <option>1024x1536</option>
            <option>1536x1024</option>
          </select>
        </div>
        <div></div>
      </div>
      <div class="btnrow">
        <button class="primary" id="btnImage">Generar Imagen</button>
      </div>
      <div class="status" id="imgStatus"><span class="dot"></span><span>Listo.</span></div>
      <div class="result" id="imgResult"></div>
    </div>
  </div>

  <div id="tab-chat" class="grid" style="display:none">
    <div class="card">
      <h2>üí¨ Chat</h2>
      <label>Mensaje</label>
      <textarea id="chatMsg" placeholder="Escribe tu mensaje..."></textarea>
      <div class="btnrow">
        <button class="primary" id="btnChat">Enviar</button>
      </div>
      <div class="status" id="chatStatus"><span class="dot"></span><span>Listo.</span></div>
      <div class="result" id="chatResult"></div>
    </div>
  </div>

</div>

<script>
  // =========================
  // Helpers
  // =========================
  const $ = (id) => document.getElementById(id);

  function setStatus(elId, type, text){
    const el = $(elId);
    if(!el) return;
    const dot = el.querySelector(".dot");
    const span = el.querySelector("span:last-child");
    dot.classList.remove("good","bad");
    if(type === "good") dot.classList.add("good");
    if(type === "bad") dot.classList.add("bad");
    span.textContent = text;
  }

  function absUrl(maybeRelative){
    if(!maybeRelative) return "";
    if(maybeRelative.startsWith("http")) return maybeRelative;
    const base = window.location.origin;
    return base + (maybeRelative.startsWith("/") ? maybeRelative : "/" + maybeRelative);
  }

  async function postJSON(path, payload){
    const res = await fetch(path, {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(payload)
    });
    const data = await res.json().catch(()=> ({}));
    if(!res.ok) throw new Error(data?.message || ("HTTP " + res.status));
    return data;
  }

  // =========================
  // Render: Video con botones
  // =========================
  function renderVideoResult(containerId, videoUrl){
    const el = $(containerId);
    if(!el) return;
    const url = absUrl(videoUrl);

    el.innerHTML = `
      <div style="
        margin-top:12px;
        padding:14px;
        border:1px solid rgba(255,255,255,.14);
        border-radius:18px;
        background: rgba(255,255,255,.06);
        backdrop-filter: blur(10px);
      ">
        <div style="font-weight:900; margin-bottom:10px;">‚úÖ Video listo</div>

        <video controls playsinline style="
          width:100%;
          max-width:520px;
          border-radius:14px;
          border:1px solid rgba(255,255,255,.12);
          background:#000;
        ">
          <source src="${url}" type="video/mp4" />
          Tu navegador no puede reproducir este video.
        </video>

        <div style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;">
          <a href="${url}" target="_blank" rel="noopener"
             style="padding:10px 14px; border-radius:12px; background:#7C5CFF; color:#fff; text-decoration:none; font-weight:900;">
            ‚ñ∂Ô∏è Abrir
          </a>

          <a href="${url}" download
             style="padding:10px 14px; border-radius:12px; background:rgba(255,255,255,.12); color:#fff; text-decoration:none; font-weight:900; border:1px solid rgba(255,255,255,.16);">
            ‚¨áÔ∏è Descargar MP4
          </a>

          <button id="${containerId}-copy"
             style="padding:10px 14px; border-radius:12px; background:rgba(255,255,255,.08); color:#fff; font-weight:900; border:1px solid rgba(255,255,255,.16); cursor:pointer;">
            üìã Copiar link
          </button>
        </div>

        <div style="opacity:.75; font-size:12px; margin-top:10px; word-break:break-all;">
          ${url}
        </div>
      </div>
    `;

    const btn = document.getElementById(containerId + "-copy");
    if(btn){
      btn.onclick = async () => {
        try{
          await navigator.clipboard.writeText(url);
          btn.textContent = "‚úÖ Copiado";
          setTimeout(()=> btn.textContent = "üìã Copiar link", 1200);
        }catch(e){
          btn.textContent = "‚ùå No se pudo copiar";
          setTimeout(()=> btn.textContent = "üìã Copiar link", 1500);
        }
      };
    }
  }

  // =========================
  // Render: Imagen
  // =========================
  function renderImage(containerId, imageUrl){
    const el = $(containerId);
    if(!el) return;
    const url = absUrl(imageUrl);

    el.innerHTML = `
      <div style="
        margin-top:12px;
        padding:14px;
        border:1px solid rgba(255,255,255,.14);
        border-radius:18px;
        background: rgba(255,255,255,.06);
      ">
        <div style="font-weight:900; margin-bottom:10px;">‚úÖ Imagen lista</div>
        <img src="${url}" style="width:100%;max-width:520px;border-radius:14px;border:1px solid rgba(255,255,255,.12)" />
        <div style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;">
          <a href="${url}" target="_blank" rel="noopener"
             style="padding:10px 14px; border-radius:12px; background:#7C5CFF; color:#fff; text-decoration:none; font-weight:900;">
            ‚ñ∂Ô∏è Abrir
          </a>
          <a href="${url}" download
             style="padding:10px 14px; border-radius:12px; background:rgba(255,255,255,.12); color:#fff; text-decoration:none; font-weight:900; border:1px solid rgba(255,255,255,.16);">
            ‚¨áÔ∏è Descargar
          </a>
        </div>
      </div>
    `;
  }

  // =========================
  // Tabs
  // =========================
  document.querySelectorAll(".tab").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      document.querySelectorAll(".tab").forEach(b=> b.classList.remove("active"));
      btn.classList.add("active");
      const tab = btn.dataset.tab;

      ["cine","reels","imagen","chat"].forEach(t=>{
        const el = document.getElementById("tab-" + t);
        if(el) el.style.display = (t === tab) ? "" : "none";
      });
    });
  });

  // =========================
  // Toggles
  // =========================
  function setupToggle(toggleId){
    const t = $(toggleId);
    if(!t) return;
    t.addEventListener("click", ()=> t.classList.toggle("on"));
  }
  setupToggle("cineModeToggle");
  setupToggle("reelsModeToggle");

  function toggleModeValue(toggleId){
    const t = $(toggleId);
    return (t && t.classList.contains("on")) ? "narrator_plus_character" : "narrator_only";
  }

  // =========================
  // Presets (localStorage)
  // =========================
  const PRESET_KEY = "corazon_presets_v1";

  function loadPresets(){
    try{ return JSON.parse(localStorage.getItem(PRESET_KEY) || "[]"); }
    catch(e){ return []; }
  }
  function savePresets(arr){
    localStorage.setItem(PRESET_KEY, JSON.stringify(arr));
  }
  function refreshPresetSelect(){
    const select = $("presetSelect");
    const presets = loadPresets();
    select.innerHTML = `<option value="">‚Äî</option>`;
    presets.forEach((p, idx)=>{
      const opt = document.createElement("option");
      opt.value = String(idx);
      opt.textContent = p.name;
      select.appendChild(opt);
    });
  }
  function getCurrentSettings(){
    return {
      reels: {
        text: $("reelsText").value,
        language: $("reelsLang").value,
        voice_gender: $("reelsVoiceGender").value,
        duration: Number($("reelsDuration").value),
        music: $("reelsMusic").value,
        mode: toggleModeValue("reelsModeToggle"),
        format: "9:16"
      },
      cine: {
        text: $("cineText").value,
        language: $("cineLang").value,
        voice_gender: $("cineVoiceGender").value,
        duration: Number($("cineDuration").value),
        music: $("cineMusic").value,
        mode: toggleModeValue("cineModeToggle"),
        format: "9:16"
      }
    };
  }
  function applySettings(s){
    if(s?.reels){
      $("reelsText").value = s.reels.text || "";
      $("reelsLang").value = s.reels.language || "es";
      $("reelsVoiceGender").value = s.reels.voice_gender || "female";
      $("reelsDuration").value = String(s.reels.duration || 9);
      $("reelsMusic").value = s.reels.music || "soft";
      $("reelsModeToggle").classList.toggle("on", s.reels.mode === "narrator_plus_character");
    }
    if(s?.cine){
      $("cineText").value = s.cine.text || "";
      $("cineLang").value = s.cine.language || "es";
      $("cineVoiceGender").value = s.cine.voice_gender || "female";
      $("cineDuration").value = String(s.cine.duration || 5);
      $("cineMusic").value = s.cine.music || "soft";
      $("cineModeToggle").classList.toggle("on", s.cine.mode === "narrator_plus_character");
    }
  }

  $("btnSavePreset").onclick = () => {
    const name = $("presetName").value.trim();
    if(!name){
      $("presetInfo").textContent = "Pon un nombre primero üôÇ";
      setTimeout(()=> $("presetInfo").textContent = "Se guardan en tu navegador", 1300);
      return;
    }
    const presets = loadPresets();
    presets.push({name, settings: getCurrentSettings(), createdAt: Date.now()});
    savePresets(presets);
    refreshPresetSelect();
    $("presetName").value = "";
    $("presetInfo").textContent = "‚úÖ Guardado";
    setTimeout(()=> $("presetInfo").textContent = "Se guardan en tu navegador", 1200);
  };

  $("btnApplyPreset").onclick = () => {
    const idx = $("presetSelect").value;
    if(idx === "") return;
    const presets = loadPresets();
    const p = presets[Number(idx)];
    if(!p) return;
    applySettings(p.settings);
    $("presetInfo").textContent = "‚úÖ Aplicado";
    setTimeout(()=> $("presetInfo").textContent = "Se guardan en tu navegador", 1200);
  };

  $("btnDeletePreset").onclick = () => {
    const idx = $("presetSelect").value;
    if(idx === "") return;
    const presets = loadPresets();
    presets.splice(Number(idx), 1);
    savePresets(presets);
    refreshPresetSelect();
    $("presetInfo").textContent = "üóëÔ∏è Eliminado";
    setTimeout(()=> $("presetInfo").textContent = "Se guardan en tu navegador", 1200);
  };

  refreshPresetSelect();

  // =========================
  // Actions: Chat / Image
  // =========================
  $("btnChat").onclick = async () => {
    const msg = $("chatMsg").value.trim();
    if(!msg) return;
    setStatus("chatStatus","", "Enviando...");
    $("btnChat").disabled = true;
    try{
      const data = await postJSON("/chat", {message: msg});
      $("chatResult").innerHTML = `<div class="card" style="margin-top:10px">${(data.reply||"").replaceAll("\n","<br>")}</div>`;
      setStatus("chatStatus","good", "‚úÖ Listo");
    }catch(e){
      setStatus("chatStatus","bad", "‚ùå " + e.message);
    }finally{
      $("btnChat").disabled = false;
    }
  };

  $("btnImage").onclick = async () => {
    const prompt = $("imgPrompt").value.trim();
    if(!prompt) return;
    setStatus("imgStatus","", "Generando...");
    $("btnImage").disabled = true;
    try{
      const data = await postJSON("/image", {prompt, size: $("imgSize").value});
      if(data.image_url){
        renderImage("imgResult", data.image_url);
        setStatus("imgStatus","good","‚úÖ Imagen lista");
      }else{
        setStatus("imgStatus","bad","‚ùå No lleg√≥ image_url");
        $("imgResult").textContent = JSON.stringify(data);
      }
    }catch(e){
      setStatus("imgStatus","bad","‚ùå " + e.message);
    }finally{
      $("btnImage").disabled = false;
    }
  };

  // =========================
  // Actions: Reels
  // =========================
  $("btnReelsOnly").onclick = async () => {
    const text = $("reelsText").value.trim();
    if(!text) return;
    setStatus("reelsStatus","", "Creando reels...");
    $("btnReelsOnly").disabled = true;
    try{
      // endpoint /reels devuelve FileResponse mp4, NO JSON
      const res = await fetch("/reels", {
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({text, duration: Number($("reelsDuration").value), format:"9:16", cfg:0.5})
      });
      if(!res.ok) throw new Error("HTTP " + res.status);
      const blob = await res.blob();
      const url = URL.createObjectURL(blob);

      $("reelsResult").innerHTML = `
        <div style="margin-top:12px;padding:14px;border:1px solid rgba(255,255,255,.14);border-radius:18px;background:rgba(255,255,255,.06);">
          <div style="font-weight:900;margin-bottom:10px;">‚úÖ Reels listo</div>
          <video controls playsinline style="width:100%;max-width:520px;border-radius:14px;border:1px solid rgba(255,255,255,.12);background:#000;">
            <source src="${url}" type="video/mp4" />
          </video>
          <div style="display:flex;gap:10px;margin-top:12px;flex-wrap:wrap;">
            <a href="${url}" target="_blank" rel="noopener"
               style="padding:10px 14px;border-radius:12px;background:#7C5CFF;color:#fff;text-decoration:none;font-weight:900;">‚ñ∂Ô∏è Abrir</a>
            <a href="${url}" download="reels.mp4"
               style="padding:10px 14px;border-radius:12px;background:rgba(255,255,255,.12);color:#fff;text-decoration:none;font-weight:900;border:1px solid rgba(255,255,255,.16);">‚¨áÔ∏è Descargar MP4</a>
          </div>
          <div style="opacity:.75;font-size:12px;margin-top:10px;">(Este es un archivo temporal en tu navegador)</div>
        </div>
      `;
      setStatus("reelsStatus","good","‚úÖ Listo");
    }catch(e){
      setStatus("reelsStatus","bad","‚ùå " + e.message);
    }finally{
      $("btnReelsOnly").disabled = false;
    }
  };

  $("btnReels").onclick = async () => {
    const text = $("reelsText").value.trim();
    if(!text) return;
    setStatus("reelsStatus","", "Creando reels con voz+m√∫sica...");
    $("btnReels").disabled = true;
    try{
      const payload = {
        text,
        duration: Number($("reelsDuration").value),
        format: "9:16",
        language: $("reelsLang").value,
        mode: toggleModeValue("reelsModeToggle"),
        voice_gender: $("reelsVoiceGender").value,
        music: $("reelsMusic").value
      };
      const data = await postJSON("/reels-voice", payload);

      if(data.video_url){
        renderVideoResult("reelsResult", data.video_url);
        setStatus("reelsStatus","good","‚úÖ Listo");
      }else{
        setStatus("reelsStatus","bad","‚ùå No lleg√≥ video_url");
        $("reelsResult").textContent = JSON.stringify(data);
      }
    }catch(e){
      setStatus("reelsStatus","bad","‚ùå " + e.message);
    }finally{
      $("btnReels").disabled = false;
    }
  };

  // =========================
  // Actions: Cine
  // =========================
  $("btnCineOnly").onclick = async () => {
    const text = $("cineText").value.trim();
    if(!text) return;
    setStatus("cineStatus","", "Creando cine (solo)...");

    $("btnCineOnly").disabled = true;
    try{
      const data = await postJSON("/video-cine", {
        text,
        duration: Number($("cineDuration").value),
        format:"9:16",
        cfg:0.5
      });

      // /video-cine devuelve video_url externo (FAL)
      if(data.video_url){
        // render tambi√©n (pero es URL externa)
        renderVideoResult("cineResult", data.video_url);
        setStatus("cineStatus","good","‚úÖ Listo");
      }else{
        setStatus("cineStatus","bad","‚ùå No lleg√≥ video_url");
        $("cineResult").textContent = JSON.stringify(data);
      }
    }catch(e){
      setStatus("cineStatus","bad","‚ùå " + e.message);
    }finally{
      $("btnCineOnly").disabled = false;
    }
  };

  $("btnCine").onclick = async () => {
    const text = $("cineText").value.trim();
    if(!text) return;
    setStatus("cineStatus","", "Creando cine con voz+m√∫sica...");
    $("btnCine").disabled = true;

    try{
      const payload = {
        text,
        duration: Number($("cineDuration").value),
        format:"9:16",
        cfg:0.5,
        language: $("cineLang").value,
        mode: toggleModeValue("cineModeToggle"),
        voice_gender: $("cineVoiceGender").value,
        music: $("cineMusic").value
      };
      const data = await postJSON("/video-cine-voice", payload);

      if(data.video_url){
        renderVideoResult("cineResult", data.video_url);
        setStatus("cineStatus","good","‚úÖ Listo");
      }else{
        setStatus("cineStatus","bad","‚ùå No lleg√≥ video_url");
        $("cineResult").textContent = JSON.stringify(data);
      }
    }catch(e){
      setStatus("cineStatus","bad","‚ùå " + e.message);
    }finally{
      $("btnCine").disabled = false;
    }
  };

</script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Coraz√≥n Studio AI</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 40px; }
    .card { max-width: 560px; margin: 0 auto; padding: 24px; border: 1px solid #ddd; border-radius: 14px; }
    h1 { margin: 0 0 8px; }
    p { margin: 8px 0 18px; color: #444; }
    select, textarea, button { width: 100%; max-width: 520px; padding: 12px; margin: 8px 0; font-size: 16px; }
    textarea { height: 110px; }
    button { cursor: pointer; }
    .out { margin-top: 18px; font-size: 16px; text-align: left; white-space: pre-wrap; }
    .ok { color: #0a7a2f; font-weight: 600; }
    .err { color: #b00020; font-weight: 600; }
    .muted { color: #777; font-size: 14px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>üíô Coraz√≥n Studio AI</h1>
    <p id="subtitle">Tu plataforma de inteligencia artificial con prop√≥sito.</p>

    <label for="lang" class="muted">Idioma / Language</label>
    <select id="lang" onchange="onLangChange()">
      <option value="es" selected>Espa√±ol</option>
      <option value="en">English</option>
    </select>

    <button onclick="probarConexion()" id="btnTest">Probar conexi√≥n</button>

    <textarea id="msg" placeholder="Escribe tu mensaje aqu√≠..."></textarea>
    <button onclick="enviarMensaje()" id="btnSend">Enviar</button>

    <div id="status" class="out muted"></div>
    <div id="respuesta" class="out"></div>
  </div>

  <script>
    // ‚úÖ Pega aqu√≠ tu URL de Render (la tuya)
    const BACKEND_URL = "https://corazon-studio-ai-backend-3.onrender.com";

    function t() {
      const lang = document.getElementById("lang").value;
      return {
        es: {
          test: "Probar conexi√≥n",
          send: "Enviar",
          placeholder: "Escribe tu mensaje aqu√≠...",
          connected: "‚úÖ Conectado correctamente",
          connecting: "Conectando...",
          sending: "Enviando...",
          err: "‚ùå Error: ",
          replyTitle: "Respuesta:"
        },
        en: {
          test: "Test connection",
          send: "Send",
          placeholder: "Type your message here...",
          connected: "‚úÖ Connected successfully",
          connecting: "Connecting...",
          sending: "Sending...",
          err: "‚ùå Error: ",
          replyTitle: "Reply:"
        }
      }[lang];
    }

    function onLangChange() {
      const lang = document.getElementById("lang").value;
      document.documentElement.lang = lang;
      document.getElementById("btnTest").innerText = t().test;
      document.getElementById("btnSend").innerText = t().send;
      document.getElementById("msg").placeholder = t().placeholder;
      document.getElementById("status").innerText = "";
      document.getElementById("respuesta").innerText = "";
    }

    async function probarConexion() {
      const status = document.getElementById("status");
      const out = document.getElementById("respuesta");
      status.className = "out muted";
      out.innerText = "";
      status.innerText = t().connecting;

      try {
        const res = await fetch(`${BACKEND_URL}/health`, { method: "GET" });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        status.className = "out ok";
        status.innerText = t().connected;
      } catch (e) {
        status.className = "out err";
        status.innerText = t().err + e.message;
      }
    }

    async function enviarMensaje() {
      const status = document.getElementById("status");
      const out = document.getElementById("respuesta");
      const msg = document.getElementById("msg").value.trim();
      const lang = document.getElementById("lang").value;

      out.innerText = "";
      status.className = "out muted";
      status.innerText = t().sending;

      if (!msg) {
        status.className = "out err";
        status.innerText = (lang === "es") ? "‚ùå Escribe un mensaje primero." : "‚ùå Please type a message first.";
        return;
      }

      try {
        const res = await fetch(`${BACKEND_URL}/chat`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: msg, language: lang })
        });

        const data = await res.json();
        if (!res.ok) throw new Error(data?.detail || `HTTP ${res.status}`);

        status.className = "out ok";
        status.innerText = t().connected;

        out.innerText = `${t().replyTitle}\n${data.reply}`;
      } catch (e) {
        status.className = "out err";
        status.innerText = t().err + e.message;
      }
    }

    // Iniciar textos correctos
    onLangChange();
  </script>
</body>
</html>
